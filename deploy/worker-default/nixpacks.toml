# Worker service build configuration (standalone jinn-node repo)
# Pin to nixpkgs archive that includes Node.js 22
[phases.setup]
nixpkgsArchive = "51ad838b03a05b1de6f9f2a0fffecee64a9788ee"
aptPkgs = ["python3", "openssh-client"]

[phases.install]
cmds = ["yarn install --frozen-lockfile", "npm install -g @google/gemini-cli@0.25.0"]

[phases.build]
cmds = ["yarn run build && ln -sf $(which node | xargs dirname)/gemini /usr/bin/gemini"]

[start]
cmd = "node dist/worker/worker_launcher.js"
